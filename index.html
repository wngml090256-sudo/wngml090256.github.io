
<!doctype html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MSE8XGWE33"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-MSE8XGWE33');
  </script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  
  <title>ìì—° ì† ì˜¤ê°í…Œë¼í”¼ BOOK</title>
  <meta property="og:title" content="ìì—° ì† ì˜¤ê°í…Œë¼í”¼ BOOK" />
  <meta property="og:description" content="ë‚˜ì—ê²Œ ë§ëŠ” ìì—°ì˜ í–¥ê¸°ì™€ ì°¨ë¥¼ ì°¾ì•„ë³´ì„¸ìš”." />
  <meta property="og:image" content="https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=1200&auto=format&fit=crop" />
  
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Pretendard:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* í°íŠ¸ ë° ê¸°ë³¸ ì„¤ì • */
    @font-face {
        font-family: 'Binggrae';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/Binggrae.woff') format('woff');
        font-weight: normal; font-style: normal;
    }
    @font-face {
        font-family: 'Binggrae-Bold';
        src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_one@1.0/Binggrae-Bold.woff') format('woff');
        font-weight: 700; font-style: normal;
    }

    :root{
      --accent:#2f8a58; 
      --accent2:#d4a024; 
      --font-title: 'Binggrae-Bold', 'Binggrae', sans-serif;
      --font-body: 'Binggrae', "Pretendard", sans-serif;
      --font-hand: "Nanum Pen Script", cursive;
    }

    *{box-sizing:border-box}

    body{
      margin:0; font-family: var(--font-body);
      background: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.4)), url('forest.jpeg');
      background-size: cover; background-position: center; background-attachment: fixed; background-repeat: no-repeat;
      color: #fff; min-height:100svh; display:flex; align-items:center; justify-content:center;
      padding:16px; overflow-x:hidden; -webkit-tap-highlight-color: transparent; letter-spacing: -0.02em;
    }

    .wrap{width:min(720px, 100%)}

    .card{
      --text: #4e342e; --muted: #8d6e63; --border: rgba(0,0,0,0.1);
      background: rgba(255, 255, 255, 0.96); border:1px solid rgba(255,255,255,0.6);
      border-radius:24px; padding: 24px; 
      box-shadow: 0 10px 40px rgba(0,0,0,.25); backdrop-filter: blur(12px);
      min-height: 600px; height: auto; display: flex; flex-direction: column; color: var(--text); position: relative;
    }

    header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; gap: 8px; }
    .header-left { flex: 1; min-width: 0; } 
    .header-right { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }

    h1 { font-family: var(--font-title); font-size: 26px; margin: 0; letter-spacing: -0.5px; line-height: 1.3; color: #2e7d32; word-break: keep-all; }
    .sub { color: var(--muted); font-size: 15px; margin-top: 6px; line-height: 1.4; word-break: keep-all; }

    .pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 12px; border-radius:999px; border:1px solid var(--border); color: #5d4037; font-size:13px; white-space:nowrap; background: rgba(255,255,255,0.6); }

    .icon-btn { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; background: #fff; border: 1px solid var(--border); border-radius: 50%; color: var(--accent); cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: all 0.2s ease; }
    .icon-btn svg { width: 18px; height: 18px; }

    .bar{ height:8px; border-radius:999px; background: rgba(0,0,0,.08); overflow:hidden; margin:10px 0 20px; }
    .bar > div{ height:100%; width:0%; background: linear-gradient(90deg, #a5d6a7, #2f8a58); transition: width .3s ease; }

    .btn{ border:1px solid var(--border); background: #fff; color: var(--text); padding:14px 16px; border-radius:16px; cursor:pointer; font-size:16px; transition: all .2s; font-family: var(--font-title); word-break: keep-all; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .btn:hover{ background: #f1f8e9; border-color: var(--accent); }
    .btn.primary{ background: #e8f5e9; border-color: #a5d6a7; color: #1b5e20; }
    .btn.capture { border-color: #4e342e; color: #fff; background: #4e342e; }
    .btn.danger{ border-color: #ffccbc; color: #d84315; background: #fbe9e7; }
    .btn.accent { background: #2f8a58; color: #fff; border: none; margin-top: 20px; padding: 16px; font-size: 17px; font-family: var(--font-title); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; background: #eee; color: #aaa; border-color: #ddd; }

    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    @media(max-width: 500px) { .menu-grid { grid-template-columns: 1fr; } }

    .hero-btn { position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 220px; padding: 16px; border: 1px solid var(--border); border-radius: 24px; background: rgba(255,255,255,0.7); color: var(--text); cursor: pointer; text-align: center; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
    .hero-btn:active { transform: scale(0.98); background: #fff; }
    .hero-btn .icon-area { flex: 0 0 auto; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; }
    .hero-btn svg { width: 64px; height: 64px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
    .hero-btn .label { font-size: 19px; margin-bottom: 4px; color: #2e7d32; font-family: var(--font-title); }
    .hero-btn .desc { font-size: 13px; color: var(--muted); line-height: 1.4; }

    .tea-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .tea-btn { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 14px 8px; border: 1px solid var(--border); border-radius: 20px; background: rgba(255,255,255,0.6); color: var(--text); cursor: pointer; }
    .tea-btn svg { width: 36px; height: 36px; }
    .tea-btn span { font-size: 14px; font-family: var(--font-title); text-align: center; }

    .q-title{ font-size:20px; margin:0 0 20px; line-height:1.45; font-family: var(--font-title); color: #2e7d32; word-break: keep-all; }
    .choices{display:grid; gap:10px;}
    button.choice{ text-align:left; width:100%; border-radius:18px; border:1px solid var(--border); background: #fff; color: var(--text); padding:18px; font-size:16px; cursor:pointer; font-family: var(--font-body); line-height: 1.4; word-break: keep-all; }
    @media (hover: hover) { button.choice:hover { background: #f1f8e9; border-color: var(--accent); } }
    button.choice.clicked { background: #e8f5e9; border-color: var(--accent); color: #1b5e20; font-family: var(--font-title); }

    .pref-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 340px; margin: 0 auto 20px; }
    .pref-card { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 12px; background: #fff; border: 1px solid #eee; border-radius: 20px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.03); transition: all 0.15s ease-out; -webkit-user-select: none; user-select: none; outline: none; }
    .pref-card.clicked { background-color: #e8f5e9 !important; border-color: var(--accent) !important; transform: scale(0.96); box-shadow: 0 0 0 2px rgba(47, 138, 88, 0.2); }
    .pref-img { width: 100px; height: 100px; object-fit: contain; margin-bottom: 8px; pointer-events: none; }
    .pref-name { font-size: 16px; font-family: var(--font-title); color: #3e2723; margin-bottom: 2px; pointer-events: none; }
    .pref-desc { font-size: 11px; color: #8d6e63; text-align: center; word-break: keep-all; line-height: 1.2; pointer-events: none; }

    .wide-btn { width: 100%; margin-top: 12px; padding: 16px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); border-radius: 18px; background: #fff; color: var(--text); cursor: pointer; font-family: var(--font-title); }

    .result .box{ border:1px solid #d7ccc8; border-radius:20px; padding: 24px; background: #fffaf0; margin-bottom: 14px; box-shadow: 0 4px 12px rgba(62, 39, 35, 0.05); word-break: keep-all; }
    .tag{ display:inline-flex; padding:4px 10px; border-radius:999px; border:1px solid #a1887f; font-size:13px; color: #5d4037; margin-right:6px; margin-bottom: 6px; background: #fff; }

    .oil-card { background: #fff; border-left: 5px solid var(--accent2); padding: 16px; margin-bottom: 12px; border-radius: 16px; box-shadow: 0 2px 6px rgba(0,0,0,0.04); color: #3e2723; display: flex; align-items: center; }
    .oil-card.best { background: linear-gradient(135deg, #fff8e1 0%, #fff 100%); border: 2px solid var(--accent2); transform: scale(1.02); margin-bottom: 20px; box-shadow: 0 8px 24px rgba(212, 160, 36, 0.15); position: relative; }
    .oil-card.best::after { content: 'ğŸ‘‘ Best Pick'; position: absolute; top: -12px; right: 12px; background: #d4a024; color: #fff; font-size: 12px; padding: 4px 10px; border-radius: 12px; font-family: var(--font-title); }
    
    .persona-card { background: #efebe9; border: 1px dashed #a1887f; padding: 18px; border-radius: 16px; margin-bottom: 20px; text-align: center; }
    .persona-title { color: #5d4037; font-size: 17px; margin-bottom: 8px; font-family: var(--font-title); }
    .persona-desc { font-size: 15px; color: #4e342e; line-height: 1.6; word-break: keep-all; }
    
    .empathy-msg { background: #e8f5e9; padding: 18px; border-radius: 16px; margin-bottom: 24px; text-align: center; font-size: 16px; font-weight: 600; line-height: 1.6; color: #1b5e20; word-break: keep-all; box-shadow: 0 2px 8px rgba(47, 138, 88, 0.1); }
    .analysis-box { background:#fff; border:1px solid #d7ccc8; border-left:5px solid #2f8a58; border-radius:12px; padding:18px; margin-bottom:24px; text-align:left; }
    .analysis-title { font-size: 18px; font-family: var(--font-title); color: #2f8a58; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    .analysis-text { font-size: 16px; color: #4e342e; line-height: 1.65; word-break: keep-all; }

    /* ë ˆì‹œí”¼ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .recipe-intro-btn {
        display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
        padding: 24px; height: 160px;
        border: 1px solid var(--border); border-radius: 20px;
        background: #fff; color: var(--text); cursor: pointer; transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
    .recipe-intro-btn:hover { border-color: var(--accent); background: #f1f8e9; }
    .recipe-intro-btn strong { font-size: 18px; color: #2e7d32; font-family: var(--font-title); }
    .recipe-intro-btn span { font-size: 14px; color: var(--muted); line-height: 1.4; }

    .selection-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 24px; }
    .oil-select-item { 
        padding: 14px; border: 1px solid #d7ccc8; border-radius: 16px; 
        background: #fff; cursor: pointer; text-align: center; font-size: 15px; 
        transition: 0.2s; word-break: keep-all; font-family: var(--font-title); position: relative;
    }
    .oil-select-item.selected { background-color: var(--accent); color: white; border-color: var(--accent); }
    .oil-select-item.ai-pick { background-color: #fff8e1; color: #d4a024; border-color: #d4a024; font-weight: bold; }
    .oil-select-item.ai-pick::after { content: 'AI ì¶”ì²œ'; position: absolute; top: -6px; right: -6px; background: #d4a024; color: white; font-size: 10px; padding: 2px 6px; border-radius: 8px; }

    .recipe-box { background: #e8f5e9; padding: 20px; border-radius: 20px; margin-bottom: 16px; border: 1px dashed var(--accent); }
    .drop-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 16px;}
    
    .footer{ margin-top:auto; padding-top:24px; display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px; color: #8d6e63; font-size:12px; word-break: keep-all; line-height: 1.4; }
    .nav { display:flex; justify-content:space-between; margin-top:24px; }
    .hidden { display: none !important; }
    .tiny { font-size: 13px; color: var(--muted); margin-bottom: 8px; }

    .closing-q { text-align: center; margin-top: 24px; font-size: 19px; color: #5d4037; font-family: var(--font-hand); line-height: 1.4; }
    .signature { text-align: right; margin-top: 12px; font-size: 22px; color: #8d6e63; font-family: var(--font-hand); }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(3px); }
    .modal-box { background: white; width: 300px; padding: 24px; border-radius: 24px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
    .qr-img { width: 160px; height: 160px; margin: 0 auto 16px; display: block; }
    .url-input { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #d7ccc8; border-radius: 12px; background: #f5f5f5; font-family: var(--font-body); }
    
    @media(max-width: 480px) {
        body { padding: 12px; }
        .card { padding: 16px; min-height: 90svh; border-radius: 20px; }
        .result .box { padding: 20px 16px; }
        h1 { font-size: 22px; }
        .analysis-text { font-size: 16px !important; }
        .persona-desc { font-size: 16px !important; }
        .oil-card .scent-desc { font-size: 14px !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="app">
      <header>
        <div class="header-left">
          <h1 id="pageTitle">ìì—° ì† ì˜¤ê°í…Œë¼í”¼ BOOK</h1>
          <div class="sub" id="pageSub">ë‚˜ì—ê²Œ ë§ëŠ” ìì—°ì˜ í–¥ê¸°ì™€ ì°¨ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.</div>
        </div>
        <div class="header-right">
          <button class="icon-btn" onclick="openShareModal()" aria-label="ê³µìœ í•˜ê¸°">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
          </button>
          <button class="icon-btn" onclick="setView('home')" aria-label="ì²˜ìŒìœ¼ë¡œ">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </button>
        </div>
      </header>
      <div style="margin-bottom:10px;"><div class="pill" id="stepPill">HOME</div></div>

      <div class="bar" aria-hidden="true"><div id="barFill"></div></div>

      <main id="mainContent">
      </main>

      <div class="footer">
        <div>Â© ìì—°í™˜ê²½í•´ì„¤ì‚¬ ì •ì£¼í¬ Â· ë§í¬ ê³µìœ  í™˜ì˜</div>
        <div>* ì˜í•™ì  ì§„ë‹¨ì´ ì•„ë‹Œ ì·¨í–¥/ì»¨ë””ì…˜ ê¸°ë°˜ ì¶”ì²œì…ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <div id="shareModal" class="modal-overlay hidden" onclick="closeShareModal(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
      <h3>QRì½”ë“œ ê³µìœ </h3>
      <img id="qrImage" src="" alt="QR Code" class="qr-img">
      <input type="text" id="shareUrlInput" class="url-input" readonly>
      <div style="display:flex; gap:8px;">
        <button class="btn primary" style="flex:1" onclick="copyShareUrl()">ì£¼ì†Œ ë³µì‚¬</button>
        <button class="btn" style="flex:1" onclick="closeShareModal()">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

<script>
(() => {
  let CURRENT_URL = window.location.href;

  const ICONS = {
    oil: `<img src="titleoil.png" alt="ì—ì„¼ì…œì˜¤ì¼" style="width: 100px; height: 100px; object-fit: contain; margin-bottom: 12px;">`,
    tea: `<img src="teaset.png" alt="ë‹¤ë„ì„¸íŠ¸" style="width: 100px; height: 100px; object-fit: contain; margin-bottom: 12px;">`,
    yakseon: `<svg viewBox="0 0 24 24" fill="none" stroke="#d68c00" stroke-width="1.5"><path d="M12 3v18m-9-9h18" stroke="currentColor"/><circle cx="12" cy="12" r="5" fill="rgba(214,140,0,0.1)"/></svg>`, 
    herb: `<svg viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="1.5"><path d="M12 22s8-10 8-16a8 8 0 0 0-16 0c0 6 8 16 8 16z"/><path d="M12 6v8"/></svg>`, 
    green: `<svg viewBox="0 0 24 24" fill="none" stroke="#2e7d32" stroke-width="1.5"><path d="M2 22h20M12 2v20M5 10c0-4 3-8 7-8s7 4 7 8v12H5V10z"/></svg>`,
  };

  const state = {
    view: 'home',
    quizStep: 0,
    quizPicks: [],
    oilStep: 0,
    oilTags: [],
    selectedRecipeOils: [], // ìµœì¢… ì„ íƒëœ ì˜¤ì¼ë“¤
    top5ResultOils: [],     // í€´ì¦ˆ ê²°ê³¼ Top 5 ì €ì¥
    userPreference: null,
    isProcessing: false,
    recipeMode: 'manual'    // 'manual' or 'auto'
  };

  const OIL_DATA = [
      { name: "ë¼ë²¤ë”", category: "Floral", note: "M", tags: ["íœ´ì‹", "ìˆ˜ë©´"], desc: "ë§ì€ ë°°ë ¤ë¡œ ì§€ì¹˜ì…¨êµ°ìš”. ì§€ê¸ˆì€ ì—„ë§ˆ í’ˆ ê°™ì€ ì˜¨ì „í•œ ì‰¼ì´ í•„ìš”í•´ìš”.", scentDesc: "ë³´ëë¹› ê½ƒë°­ì´ ë°”ëŒì— í©ë‚ ë¦¬ëŠ” ë“¯í•œ í¸ì•ˆí•œ í–¥" },
      { name: "ì¼ë‘ì¼ë‘", category: "Floral", note: "B", tags: ["ë§¤í˜¹", "ê°ê°"], desc: "ê°ì„±ì´ í’ë¶€í•œ ë‹¹ì‹ , ì–µëˆŒë¦° ê°ì •ì„ ë¡œë§¨í‹±í•˜ê²Œ í‘œí˜„í•´ë³´ì„¸ìš”.", scentDesc: "ë‹¬ì½¤í•˜ê³  ë¬µì§í•˜ê²Œ í”¼ì–´ì˜¤ë¥´ëŠ” ê´€ëŠ¥ì ì¸ ê½ƒí–¥ê¸°" },
      { name: "ììŠ¤ë¯¼", category: "Floral", note: "B", tags: ["ìš°ì•„", "ì‹ ë¢°"], desc: "ë‹¹ì‹ ì€ ì´ë¯¸ ê³ ê·€í•œ ì‚¬ëŒì…ë‹ˆë‹¤. ìŠ¤ìŠ¤ë¡œë¥¼ ë” ë¯¿ì–´ì£¼ì„¸ìš”.", scentDesc: "ë‹¬ë¹› ì•„ë˜ í•€ í•˜ì–€ ê½ƒì²˜ëŸ¼ ê·¸ìœ½í•˜ê³  ê¹Šì€ í–¥" },
      { name: "ë¡œì¦ˆ", category: "Floral", note: "M", tags: ["ì‚¬ë‘", "í–‰ë³µ"], desc: "ë§ˆìŒ ê¹Šì€ ê³³ ë”°ëœ»í•œ ì‚¬ë‘ì´ í•„ìš”í•˜ì‹œêµ°ìš”. ìƒì²˜ë¥¼ ë¶€ë“œëŸ½ê²Œ ê°ì‹¸ì£¼ì„¸ìš”.", scentDesc: "ìˆ˜ì²œ ì†¡ì´ ì¥ë¯¸ ê½ƒìì— íŒŒë¬»íŒ ë“¯í•œ í’ì„±í•œ í–¥" },
      { name: "ë„¤ë¡¤ë¦¬", category: "Floral", note: "M", tags: ["ìˆœìˆ˜", "ì•ˆì‹"], desc: "ì—¬ë¦° ë§ˆìŒì„ ë‹¤ì¹˜ì…¨ë‚˜ìš”? ê¹Šì€ ìŠ¬í””ì„ ë¶€ë“œëŸ½ê²Œ ì–´ë£¨ë§Œì ¸ ì£¼ì„¸ìš”.", scentDesc: "ì˜¤ë Œì§€ ê½ƒì—ì„œ ë°°ì–´ë‚˜ì˜¤ëŠ” ì„¬ì„¸í•˜ê³  ì²­ì´ˆí•œ í–¥" },
      { name: "ì œë¼ëŠ„", category: "Floral", note: "M", tags: ["ê· í˜•", "ì•ˆì •"], desc: "ê°ì •ì˜ ë¡¤ëŸ¬ì½”ìŠ¤í„° ì†ì—ì„œ í‰ì •ì‹¬ì„ ì°¾ê³  ì‹¶ìœ¼ì‹œêµ°ìš”.", scentDesc: "ì¥ë¯¸ì™€ í’€ë‚´ìŒì´ ì„ì¸ ë“¯í•œ ì‹±ê·¸ëŸ¬ìš´ ê½ƒí–¥ê¸°" },
      
      { name: "ë² ë¥´ê°€ëª»", category: "Citrus", note: "T", tags: ["ë°ìŒ", "í¬ë§"], desc: "ê½‰ ë§‰íŒ ë§ˆìŒì„ í’€ì–´ì£¼ê³  í–‡ì‚´ ê°™ì€ í¬ë§ì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "í™ì°¨(ì–¼ê·¸ë ˆì´)ì— ë‹´ê¸´ ë“¯í•œ ê³ ê¸‰ìŠ¤ëŸ½ê³  ìŒ‰ìŒ€í•œ ê·¤í–¥" },
      { name: "ë ˆëª¬ê·¸ë¼ìŠ¤", category: "Citrus", note: "T", tags: ["í™œë ¥", "ìê·¹"], desc: "ë¬´ê¸°ë ¥í•¨ì„ ëŠë¼ì‹œë‚˜ìš”? ì•¼ìƒì˜ ìƒëª…ë ¥ì´ ë‹¹ì‹ ì„ ê¹¨ì›Œì¤„ ê±°ì˜ˆìš”.", scentDesc: "í™ë‚´ìŒì´ ì„ì¸ ê±°ì¹ ê³  ê°•ë ¬í•œ ë ˆëª¬ í’€í–¥" },
      { name: "ìŠ¤ìœ„íŠ¸ì˜¤ë Œì§€", category: "Citrus", note: "T", tags: ["ì›ƒìŒ", "ì²œì§„"], desc: "ê±±ì •ì€ ë‚´ë ¤ë†“ê³  ì•„ì´ì²˜ëŸ¼ í•´ë§‘ê²Œ ì›ƒê³  ì‹¶ì€ ë‚ ì´êµ°ìš”.", scentDesc: "ê»ì§ˆì„ ë§‰ ê¹ ì„ ë•Œ í¼ì§€ëŠ” ë‹¬ì½¤í•˜ê³  ìƒí¼í•œ ê³¼ì¦™í–¥" },
      { name: "ë¼ì„", category: "Citrus", note: "T", tags: ["ì¬ì¹˜", "ê°€ë²¼ì›€"], desc: "ì‚¶ì´ ë„ˆë¬´ ë¬´ê²ë‚˜ìš”? íƒ„ì‚°ìˆ˜ì²˜ëŸ¼ ê°€ë³ê³  ìœ ì¾Œí•˜ê²Œ ê¸°ë¶„ ì „í™˜í•˜ì„¸ìš”.", scentDesc: "ì…ì•ˆì— ì¹¨ì´ ê³ ì´ê²Œ í•˜ëŠ” ì¨í•˜ê³  ìŒ‰ì‹¸ë¦„í•œ ë¼ì„í–¥" },
      { name: "ë ˆëª¬", category: "Citrus", note: "T", tags: ["ìƒì¾Œ", "ì‹œì‘"], desc: "ì§€ë£¨í•œ ì¼ìƒì„ ëë‚´ê³  ë§‘ì€ ì—ë„ˆì§€ë¡œ ìƒˆë¡œ ì‹œì‘í•˜ê³  ì‹¶ìœ¼ì‹œêµ°ìš”.", scentDesc: "ì •ì‹ ì´ ë²ˆì© ë“¤ ë§Œí¼ ì‹œê³  ìƒì¾Œí•œ ë…¸ë€ìƒ‰ í–¥ê¸°" },
      
      { name: "ë¡œì¦ˆë§ˆë¦¬", category: "Herb", note: "T", tags: ["ê¸°ì–µ", "ì„ ëª…"], desc: "ìƒê°ì´ ë„ˆë¬´ ë§ìœ¼ì‹œêµ°ìš”. ì•ˆê°œë¥¼ ê±·ì–´ë‚´ê³  ì •ì‹ ì„ ë§‘ê²Œ ê¹¨ì›Œë³´ì„¸ìš”.", scentDesc: "ë¨¸ë¦¬ê°€ ë§‘ì•„ì§€ëŠ” í†¡ ì˜ëŠ” í‘¸ë¥¸ í—ˆë¸Œì˜ í–¥" },
      { name: "ìœ ì¹¼ë¦½íˆ¬ìŠ¤", category: "Herb", note: "T", tags: ["ì •í™”", "ì‹œì›"], desc: "ë‹µë‹µí•œ ìƒí™©ì— ê°‡íŒ ê¸°ë¶„ì¸ê°€ìš”? ì‹œì›í•œ ë°”ëŒìœ¼ë¡œ í™˜ê¸°ê°€ í•„ìš”í•´ìš”.", scentDesc: "ì½”ê°€ ë»¥ ëš«ë¦¬ëŠ” ë“¯í•œ ì‹œì›í•˜ê³  ì²­ëŸ‰í•œ ìˆ²ì˜ í–¥" },
      { name: "í˜í¼ë¯¼íŠ¸", category: "Herb", note: "T", tags: ["ê¹¨ì–´ë‚¨", "ì¶©ê²©"], desc: "ë‚˜íƒœí•´ì§„ ì •ì‹ ì— ì°¬ë¬¼ ê°™ì€ ìê·¹ê³¼ ìƒˆë¡œìš´ ì—ë„ˆì§€ë¥¼ ì£¼ì„¸ìš”.", scentDesc: "ë°•í•˜ì‚¬íƒ•ì²˜ëŸ¼ í™”í•˜ê³  ì°¨ê°€ìš´ ë©˜í†¨ì˜ í–¥" },
      { name: "í‹°íŠ¸ë¦¬", category: "Herb", note: "T", tags: ["ë°©ì–´", "ì²­ê²°"], desc: "ì™¸ë¶€ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œë¶€í„° ë‚˜ë¥¼ ì§€í‚¬ ë‹¨ë‹¨í•œ ë°©íŒ¨ê°€ í•„ìš”í•˜êµ°ìš”.", scentDesc: "ì•½ì´ˆì²˜ëŸ¼ ìŒ‰ì‹¸ë¦„í•˜ê³  ê¹¨ë—í•œ ì†Œë…ì˜ í–¥" },
      { name: "ì¹´ëª¨ë§ˆì¼", category: "Herb", note: "M", tags: ["ìœ„ë¡œ", "í¬ìš©"], desc: "ì˜ˆë¯¼í•´ì§„ ì‹ ê²½ì„ 'ê´œì°®ì•„'ë¼ê³  ë‹¤ë…ì—¬ì£¼ëŠ” ë”°ëœ»í•œ ìœ„ë¡œê°€ í•„ìš”í•´ìš”.", scentDesc: "ë§ë¦° ì‚¬ê³¼ì™€ êµ­í™”ì°¨ì—ì„œ ë‚˜ëŠ” ì€ì€í•˜ê³  ë‹¬í°í•œ í–¥" },
      { name: "ì‹œíŠ¸ë¡œë„¬ë¼", category: "Herb", note: "T", tags: ["ê²½ê³„", "ë°©í–¥"], desc: "ë¶ˆí•„ìš”í•œ ê´€ê³„ë¥¼ ëŠì–´ë‚´ê³  ë‚˜ë§Œì˜ ê³µê°„ì„ í™•ì‹¤íˆ í™•ë³´í•˜ì„¸ìš”.", scentDesc: "ë²Œë ˆê°€ ì‹«ì–´í•  ë§Œí¼ ê°•ë ¬í•˜ê³  ë‚ ì¹´ë¡œìš´ í’€í–¥" },
      { name: "í™”ì´íŠ¸í‹°", category: "Herb", note: "M", tags: ["ì—¬ë°±", "ì‹¬í”Œ"], desc: "ë³µì¡í•œ ê±´ ì‹«ê³  ì •ê°ˆí•œ ìƒíƒœë¥¼ ì›í•˜ì‹œëŠ”êµ°ìš”. ë§ˆìŒì— ì—¬ë°±ì„ ì£¼ì„¸ìš”.", scentDesc: "ì´ìŠ¬ ë§ºíŒ ì°»ìì²˜ëŸ¼ ì€ì€í•˜ê³  ê¹¨ë—í•œ í–¥" },

      { name: "ìƒŒë‹¬ìš°ë“œ", category: "Woody", note: "B", tags: ["ëª…ìƒ", "ì² í•™"], desc: "ì†Œë€ìŠ¤ëŸ¬ìš´ ì„¸ìƒì—ì„œ ë²—ì–´ë‚˜ ë‚´ë©´ì˜ ì†Œë¦¬ì— ì§‘ì¤‘í•  ì‹œê°„ì´ì—ìš”.", scentDesc: "ì˜¤ë˜ëœ ì‚¬ì›ì—ì„œ ë‚  ë²•í•œ ê³ ìš”í•˜ê³  ë¬µì§í•œ ë‚˜ë¬´í–¥" },
      { name: "ì‹œë”ìš°ë“œ", category: "Woody", note: "B", tags: ["ë¿Œë¦¬", "ê¸°ë‘¥"], desc: "í”ë“¤ë¦¬ëŠ” ìƒí™© ì†ì—ì„œ ëŒ€ì§€ì²˜ëŸ¼ êµ³ê±´í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì„¸ìš”.", scentDesc: "ì—°í•„ì‹¬ì—ì„œ ë‚˜ëŠ” ë“¯í•œ ê±´ì¡°í•˜ê³  ì”ì“¸í•œ ë‚˜ë¬´í–¥" },
      { name: "í”„ë‘í‚¨ì„¼ìŠ¤", category: "Woody", note: "B", tags: ["ì˜í˜¼", "ì„±ì°°"], desc: "í˜„ì‹¤ì˜ ê³ ë¯¼ì„ ë„˜ì–´ ì˜ì ì¸ í‰ì˜¨í•¨ê³¼ ì„±ì°°ì„ ì›í•˜ì‹œëŠ”êµ°ìš”.", scentDesc: "ì‹ ì„±í•œ ì˜ì‹ì— ì“°ì´ëŠ” ìŠ¤ëª¨í‚¤í•˜ê³  ì‹ ë¹„ë¡œìš´ ë‚˜ë¬´ì§„ì•¡ í–¥" },
      
      { name: "ë°”ë‹ë¼", category: "Earthy", note: "B", tags: ["ë‹¤ì •", "ì¶”ì–µ"], desc: "ë‹¤ì •í•œ ì†ê¸¸ì´ ê·¸ë¦¬ìš´ ë‚ , ë‹¬ì½¤í•œ ì¶”ì–µìœ¼ë¡œ ë§ˆìŒì„ ì±„ì›Œë³´ì„¸ìš”.", scentDesc: "ì•„ì´ìŠ¤í¬ë¦¼ì²˜ëŸ¼ ë¶€ë“œëŸ½ê³  ë‹¬ì½¤í•œ ë°”ë‹ë¼ë¹ˆ í–¥" },
  ];

  const CATEGORY_PERSONA = {
    "Floral": "ğŸ’ <strong>ê³µê° ëŠ¥ë ¥ 200% ê°ì„± ì²œì¬</strong><br>íƒ€ì¸ì˜ ê°ì •ì„ ëˆ„êµ¬ë³´ë‹¤ ì˜ ì´í•´í•˜ê³ , ë”°ëœ»í•œ ë§ í•œë§ˆë””ë¡œ ì‚¬ëŒì„ ì‚´ë¦¬ëŠ” ëŠ¥ë ¥ì´ ìˆìœ¼ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ë‘ë°›ê¸° ìœ„í•´ íƒœì–´ë‚œ ì‚¬ëŒì´ì—ìš”.",
    "Citrus": "ğŸŠ <strong>ëŒ€ì²´ë¶ˆê°€! ì¸ê°„ ë¹„íƒ€ë¯¼</strong><br>ì–´ë””ì„œë“  ë¶„ìœ„ê¸°ë¥¼ ì£¼ë„í•˜ëŠ” ê¸°ì§ˆê³¼ ë‚™ì²œì ì¸ ë§ˆì¸ë“œë¥¼ ê°€ì§€ì…¨êµ°ìš”! ì‹¤íŒ¨í•´ë„ íˆ­ í„¸ê³  ì¼ì–´ë‚˜ëŠ” ë‹¹ì‹ ì˜ íšŒë³µíƒ„ë ¥ì„±ì€ ëª¨ë‘ì˜ ë¶€ëŸ¬ì›€ì„ ì‚¬ìš”.",
    "Herb": "ğŸŒ¿ <strong>ë‹´ë°±í•˜ê³  ì¿¨í•œ ë¯¸ë‹ˆë©€ë¦¬ìŠ¤íŠ¸</strong><br>ë³µì¡í•œ ê±´ ë”± ì§ˆìƒ‰ì´ì‹œêµ°ìš”! ë‚¨ë“¤ì˜ ì‹œì„ ë³´ë‹¤ëŠ” ë‚˜ë§Œì˜ í‰í™”ì™€ ì•ˆì •ì„ ì¤‘ìš”ì‹œí•˜ëŠ” ì£¼ê´€ ëšœë ·í•œ ëª¨ìŠµì´ ì •ë§ ë©‹ì ¸ìš”.",
    "Woody": "ğŸŒ² <strong>ì‹ ë¢°ë„ 1ìœ„, ë¦¬ë”í˜• ì¸ì¬</strong><br>ê°€ë²¼ìš´ ë§ë³´ë‹¤ëŠ” ë¬µì§í•œ í–‰ë™ìœ¼ë¡œ ë³´ì—¬ì£¼ëŠ” ë¶„ì´ì‹œêµ°ìš”. ì¹œêµ¬ë“¤ì´ ê³ ë¯¼ì´ ìˆì„ ë•Œ ê°€ì¥ ë¨¼ì € ì°¾ëŠ” ë©˜í†  ê°™ì€ ì¡´ì¬ì˜ˆìš”.",
    "Earthy": "ğŸ‚ <strong>ì • ë§ê³  ì† ê¹Šì€ 'ì§„êµ­'</strong><br>ì²«ì¸ìƒì€ ì¡°ìš©í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, ì•Œë©´ ì•Œìˆ˜ë¡ ì§„êµ­ì¸ ë¶„ì´ì„¸ìš”. ë¬µë¬µíˆ ë‚´ ì‚¬ëŒì„ ì±™ê¸°ëŠ” ë‹¹ì‹ ì˜ ì˜ë¦¬ëŠ” ê·¸ ë¬´ì—‡ë³´ë‹¤ ê¹Šê³  ë‹¨ë‹¨í•´ìš”."
  };

  const OIL_QUESTIONS = [
      { 
        id: "pref", 
        q: "Q1. í‰ì†Œ ë‹¹ì‹ ì´ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” í–¥ê¸°ëŠ”?", 
        options: [
          { text: "ì‹œíŠ¸ëŸ¬ìŠ¤", desc: "ì˜¤ë Œì§€, ë ˆëª¬, ë¼ì„", tag: "Citrus", img: "citrus.png" },
          { text: "í”Œë¡œëŸ´", desc: "ì¥ë¯¸, ë¼ë²¤ë”, ê½ƒí–¥ê¸°", tag: "Floral", img: "floral.png" },
          { text: "í—ˆë¸Œ/ê·¸ë¦°", desc: "í’€ë‚´ìŒ, ìœ ì¹¼ë¦½íˆ¬ìŠ¤", tag: "Herb", img: "herb.png" },
          { text: "ìš°ë””/ì–´ìŠ¤", desc: "ë‚˜ë¬´, í™, ìˆ² ëƒ„ìƒˆ", tag: "Woody", img: "woody.png" } 
        ]
      },
      { q: "Q2. ë‚¯ì„  ìˆ²ê¸¸ì„ ê±·ë‹¤ ë¬¸ë“ ê±¸ìŒì„ ë©ˆì·„ìŠµë‹ˆë‹¤.<br>ê·¸ê³³ì—ì„œ ë‹¹ì‹ ì€ ë¬´ì—‡ì„ ë³´ê³  ìˆë‚˜ìš”?", options: [
          { text: "ë‚˜ë¬´ ì‚¬ì´ë¡œ ìŸì•„ì§€ëŠ” ì°¬ë€í•œ í–‡ì‚´", tag: "í–‡ì‚´" },
          { text: "ì•„ë¬´ë„ ë°Ÿì§€ ì•Šì€ ê¹Šì€ í™ê³¼ ë‚˜ë¬´ë¿Œë¦¬", tag: "ë¿Œë¦¬" },
          { text: "ë°”ëŒì— í”ë“¤ë¦¬ëŠ” ì‘ì€ ì•¼ìƒí™” í•œ ì†¡ì´", tag: "í”Œë¡œëŸ´" },
          { text: "ì½”ëì„ ìŠ¤ì¹˜ëŠ” ì„œëŠ˜í•˜ê³  ë§‘ì€ ê³µê¸°", tag: "ì‹œì›" }
      ]},
      { q: "Q3. ì§€ê¸ˆ ë‚˜ì—ê²Œ ê°€ì¥ í•„ìš”í•œ 'ê³µê°„'ì˜ ëŠë‚Œì€?", options: [
          { text: "ëˆ„êµ¬ì—ê²Œë„ ë°©í•´ë°›ì§€ ì•ŠëŠ” ë™êµ´ ê°™ì€ ê³³", tag: "ì°¨ë¶„í•¨" },
          { text: "ì‚¬ëŒë“¤ì˜ ì†Œë¦¬ê°€ ë“¤ë¦¬ëŠ” ë°ì€ ì¹´í˜", tag: "ì›ƒìŒ" },
          { text: "ëª¨ë“  ê²ƒì´ ì œìë¦¬ì— ì •ë¦¬ëœ ê¹”ë”í•œ ì„œì¬", tag: "ì •ëˆ" },
          { text: "í­ì‹ í•œ ì´ë¶ˆì´ ìˆëŠ” ë‹¤ë½ë°©", tag: "í¬ê·¼" }
      ]},
      { q: "Q4. ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ì„ ë•Œ ë‚˜ì˜ ë°˜ì‘ì€?", options: [
          { text: "ì†ìœ¼ë¡œ ê¾¹ ì°¸ìœ¼ë©° ì‚­íŒë‹¤", tag: "í•´ì†Œ" },
          { text: "ì˜ˆë¯¼í•´ì ¸ì„œ ë‚ ì¹´ë¡­ê²Œ ë°˜ì‘í•œë‹¤", tag: "ì•ˆì •" },
          { text: "ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì–´ ë¬´ê¸°ë ¥í•´ì§„ë‹¤", tag: "í™œë ¥" },
          { text: "ë¨¸ë¦¬ê°€ ë³µì¡í•´ì ¸ ìƒê°ì´ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤", tag: "ëª…ìƒ" }
      ]},
      { q: "Q5. ì—¬í–‰ì§€ì—ì„œ ìš°ì—°íˆ ë°›ì€ ì„ ë¬¼,<br>ë¬´ì—‡ì´ì—ˆìœ¼ë©´ ì¢‹ê² ë‚˜ìš”?", options: [
          { text: "ì§€í˜œê°€ ë‹´ê¸´ ì±…", tag: "ê¹Šì´" },
          { text: "ìƒí¼í•œ ë§›ì´ í†¡ í„°ì§€ëŠ” ì—´ëŒ€ê³¼ì¼", tag: "ìê·¹" },
          { text: "í™”ë ¤í•˜ê³  í–¥ê¸°ë¡œìš´ ê½ƒë‹¤ë°œ", tag: "ì•„ë¦„ë‹¤ì›€" },
          { text: "ë§ˆìŒì„ ì”»ì–´ì¤„ ë§‘ì€ ì°¨ í•œ ì”", tag: "ì •í™”" }
      ]},
      { q: "Q6. ë‚´ì¼ ì•„ì¹¨ ëˆˆì„ ë–´ì„ ë•Œ,<br>ê°€ì¥ ë°”ë¼ëŠ” ë‚˜ì˜ ìƒíƒœëŠ”?", options: [
          { text: "ê±±ì • ì—†ì´ ë§ˆìŒì´ ê¹ƒí„¸ì²˜ëŸ¼ ê°€ë³ê¸°ë¥¼", tag: "ê°€ë²¼ì›€" },
          { text: "ë¬´ì—‡ì´ë“  í•  ìˆ˜ ìˆëŠ” ìì‹ ê°ì´ ë„˜ì¹˜ê¸°ë¥¼", tag: "ì„ ëª…" },
          { text: "ì„¸ìƒì´ ë”°ëœ»í•˜ê³  ì•ˆì „í•˜ê²Œ ëŠê»´ì§€ê¸°ë¥¼", tag: "ì‹ ë¢°" },
          { text: "ì–´ì œì™€ëŠ” ë‹¤ë¥¸ ìƒˆë¡œìš´ ë‚´ê°€ ë˜ì–´ìˆê¸°ë¥¼", tag: "ìƒˆë¡œì›€" }
      ]},
      { q: "Q7. ì¹œêµ¬ë“¤ê³¼ì˜ ëª¨ì„ì—ì„œ ë‚˜ëŠ” ì–´ë–¤ ëª¨ìŠµì¸ê°€ìš”?", options: [
          { text: "ë¶„ìœ„ê¸°ë¥¼ ì£¼ë„í•˜ê³  ì—ë„ˆì§€ë¥¼ ë°œì‚°í•œë‹¤", tag: "ë§¤í˜¹" },
          { text: "ìƒëŒ€ì˜ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì£¼ë©° ë§ì¥êµ¬ì¹œë‹¤", tag: "ë‹¤ì •" },
          { text: "ì£¼ë³€ ì‚¬ëŒë“¤ì„ ì±™ê¸°ê³  ë³´ì‚´í•€ë‹¤", tag: "ìœ„ë¡œ" },
          { text: "ë¹¨ë¦¬ ì§‘ì— ê°€ì„œ ì‰¬ê³  ì‹¶ë‹¤ëŠ” ìƒê° ë¿", tag: "íœ´ì‹" }
      ]},
      { q: "Q8. ì§€ê¸ˆ ê°€ì¥ ëŒë¦¬ëŠ” 'ì§ˆê°'ì€?", options: [
          { text: "ê±°ì¹ ì§€ë§Œ ìì—°ìŠ¤ëŸ¬ìš´ ë‚˜ë¬´ê»ì§ˆ", tag: "ìš°ë””" },
          { text: "ë¶€ë“œëŸ½ê³  ë§¤ë„ëŸ¬ìš´ ì‹¤í¬", tag: "ê°ê°" },
          { text: "ê¹¨ë—í•˜ê³  ë°”ìŠ¤ë½ê±°ë¦¬ëŠ” ë¦°ë„¨", tag: "ì²­ê²°" },
          { text: "ë§ë‘ë§ë‘í•˜ê³  ë”°ëœ»í•œ ì†œ", tag: "ìˆœìˆ˜" }
      ]},
      { q: "Q9. ë‹¹ì‹ ì˜ ì¸ìƒì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê°€ì¹˜ëŠ”?", options: [
          { text: "í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ê· í˜•ê³¼ í‰í™”", tag: "ê· í˜•" },
          { text: "ëŠì„ì—†ì´ ì„±ì¥í•˜ê³  ë‚˜ì•„ê°€ëŠ” í˜", tag: "í¬ë§" },
          { text: "ë‚˜ë¥¼ ì§€í‚¤ëŠ” ë‹¨ë‹¨í•œ ë³´í˜¸ë§‰", tag: "ë°©ì–´" },
          { text: "ì˜í˜¼ì„ ìš¸ë¦¬ëŠ” ê¹Šì€ ê¹¨ë‹¬ìŒ", tag: "ì˜í˜¼" }
      ]}
  ];

  const TEA_TYPES = {
    warm:   { name: "ë”°ëœ»ìˆœí™˜ì°¨", example: "ìƒê°•ì°¨(ë˜ëŠ” ìƒê°•+ëŒ€ì¶”)", pitch: "í¬ê·¼í•˜ê²Œ ê°ì‹¸ì£¼ëŠ” í•œ ì”ì´ í•„ìš”í•´ìš”.", tags:["ë”°ëœ»í•¨","ì†ë°œì°¨ê°€ì›€","í¬ê·¼"], },
    cool:   { name: "ë§‘ì€ì¿¨ë§ì°¨", example: "êµ­í™”ì°¨(ë˜ëŠ” ë°•í•˜)", pitch: "ë¨¸ë¦¬ê¹Œì§€ ë§‘ì•„ì§€ëŠ” ìƒì¾Œí•¨ì´ í•„ìš”í•´ìš”.", tags:["ìƒì¾Œ","ë‘í†µ","ë¦¬ì…‹"], },
    digest: { name: "ì†Œí™”í¸ì•ˆì°¨", example: "ë³´ë¦¬ì°¨(ë˜ëŠ” ì§„í”¼)", pitch: "ì†ì„ í¸ì•ˆí•˜ê²Œ ë¹„ìš°ê³  ì‹¶ì–´ìš”.", tags:["êµ¬ìˆ˜í•¨","ë”ë¶€ë£©","ì†Œí™”"], },
    calm:   { name: "ê¸´ì¥ì™„í™”ì°¨", example: "ëŒ€ì¶”ì°¨", pitch: "ë§ˆìŒì„ ì°¨ë¶„í•˜ê²Œ ë‚®ì¶°ë³´ì„¸ìš”.", tags:["ì•ˆì •","ë¶ˆë©´","íœ´ì‹"], },
    energy: { name: "ê¸°ë ¥ì¶©ì „ì°¨", example: "ì¸ì‚¼ì°¨(ë˜ëŠ” ìŒí™”)", pitch: "ë°©ì „ëœ ì—ë„ˆì§€, ì¶©ì „ì´ í•„ìš”í•´ìš”.", tags:["ì—ë„ˆì§€","ì§€ì¹¨","í™œë ¥"], },
    water:  { name: "ìˆ˜ë¶„ì •ë¦¬ì°¨", example: "ì˜¥ìˆ˜ìˆ˜ìˆ˜ì—¼ì°¨", pitch: "ê°€ë³ê²Œ ëª¸ì„ ì •ëˆí•˜ê³  ì‹¶ì–´ìš”.", tags:["ë¶“ê¸°","ê°€ë²¼ì›€","ë°°ì¶œ"], },
    five:   { name: "ì˜¤ë¯¸ìì°¨", example: "ì˜¤ë¯¸ìì°¨", pitch: "ë‹¤ì„¯ê°€ì§€ ë§›ìœ¼ë¡œ ë¦¬ë“¬ì„ ë˜ì°¾ìœ¼ì„¸ìš”.", tags:["ìƒˆì½¤ë‹¬ì½¤","ê°ˆì¦","ê· í˜•"], }
  };

  const TEA_QUESTIONS = [
    { q: "Q1. ì§€ê¸ˆ ë‚´ ëª¸ì˜ â€œì˜¨ë„ ê°ê°â€ì€?", a: [{t:"ì†ë°œì´ ì°¨ê³  ë”°ëœ»í•œ ê²Œ ì¢‹ë‹¤",s:{warm:2,energy:1}}, {t:"ë”ìœ„ë¥¼ íƒ€ê³  ì‹œì›í•œ ê²Œ ì¢‹ë‹¤",s:{cool:2}}, {t:"ê·¸ë•Œê·¸ë•Œ ë‹¤ë¥´ë‹¤",s:{digest:1,calm:1}}, {t:"ì˜ ëª¨ë¥´ê² ë‹¤",s:{}}] },
    { q: "Q2. ìš”ì¦˜ ê°€ì¥ ë¶ˆí¸í•œ ì ì€?", a: [{t:"ì†ì´ ë”ë¶€ë£©/ê°€ìŠ¤",s:{digest:2}}, {t:"ëª©ë§ˆë¦„/ê±´ì¡°í•¨",s:{five:2}}, {t:"ëª¸ì´ ë¶“ê³  ë¬´ê±°ì›€",s:{water:2}}, {t:"ë”±íˆ ì—†ìŒ/ê¸°ë¶„ì „í™˜",s:{cool:1,calm:1}}] },
    { q: "Q3. ìŠ¤íŠ¸ë ˆìŠ¤ ì •ë„ëŠ”?", a: [{t:"ì˜ˆë¯¼í•˜ê³  ë¨¸ë¦¬ê°€ ë³µì¡",s:{calm:2}}, {t:"ì¶• ì²˜ì§€ê³  ê¸°ìš´ ì—†ìŒ",s:{energy:2}}, {t:"ìŠ¤íŠ¸ë ˆìŠ¤ ì ìŒ",s:{digest:1}}, {t:"ê°ì • ê¸°ë³µì´ ì‹¬í•¨",s:{five:1,calm:1}}] },
    { q: "Q4. ì ì€ ì˜ ì£¼ë¬´ì‹œë‚˜ìš”?", a: [{t:"ì ë“¤ê¸° í˜ë“¦",s:{calm:2}}, {t:"ìì£¼ ê¹¨ê±°ë‚˜ ê°œìš´ì¹˜ ì•ŠìŒ",s:{energy:1,calm:1}}, {t:"ì˜ ìëŠ” í¸",s:{cool:1}}, {t:"ìˆ˜ë©´ì‹œê°„ ë¶ˆê·œì¹™",s:{five:1}}] },
    { q: "Q5. ìŒì‹ ë¨¹ì€ í›„ ë°˜ì‘ì€?", a: [{t:"ê¸°ë¦„ì§„ ê²ƒ ë¨¹ìœ¼ë©´ ë¶€ë‹´",s:{digest:2}}, {t:"ë§¤ìš´/ëœ¨ê±°ìš´ ê²ƒ ë¨¹ìœ¼ë©´ í™• ë‹¬ì•„ì˜¤ë¦„",s:{cool:2}}, {t:"ì°¬ ê²ƒ ë¨¹ìœ¼ë©´ ë°° ì•„í””",s:{warm:2}}, {t:"ìƒê´€ ì—†ìŒ",s:{}}] },
    { q: "Q6. ì˜¤ëŠ˜ ë°”ë¼ëŠ” ì°¨ì˜ ì—­í• ì€?", a: [{t:"ë”°ëœ»í•˜ê²Œ ìœ„ë¡œë°›ê¸°",s:{warm:2}}, {t:"ìƒì¾Œí•˜ê²Œ ë¦¬ì…‹",s:{cool:2}}, {t:"ì† í¸í•˜ê²Œ",s:{digest:2}}, {t:"ë§ˆìŒì˜ ì•ˆì •",s:{calm:2}}] },
    { q: "Q7. ì„ í˜¸í•˜ëŠ” í–¥/ë§›ì€?", a: [{t:"ì•Œì‹¸í•œ í–¥(ìƒê°•/ê³„í”¼)",s:{warm:2}}, {t:"í–¥ê¸‹í•œ ê½ƒ/í—ˆë¸Œí–¥",s:{cool:2}}, {t:"êµ¬ìˆ˜í•œ ê³¡ë¬¼ë§›",s:{digest:2}}, {t:"ìƒˆì½¤ë‹¬ì½¤í•œ ë§›",s:{five:2}}] },
    { q: "Q8. í‰ì†Œ ë¬¼ ì„­ì·¨ëŸ‰ì€?", a: [{t:"ì˜ ì•ˆ ë§ˆì‹¬",s:{five:1,water:1}}, {t:"ë§ì´ ë§ˆì…”ë„ ê°ˆì¦ ë‚¨",s:{five:2}}, {t:"ë³´í†µ",s:{}}, {t:"ì§  ìŒì‹ ë¨¹ìœ¼ë©´ ì˜ ë¶€ìŒ",s:{water:2}}] },
    { q: "Q9. í˜„ì¬ ì—ë„ˆì§€ ìƒíƒœëŠ”?", a: [{t:"ë°°í„°ë¦¬ 10% (ì§€ì¹¨)",s:{energy:2,calm:1}}, {t:"í‰ë²”í•¨",s:{digest:1}}, {t:"ê³¼ì—´/í¥ë¶„ ìƒíƒœ",s:{cool:2}}, {t:"ë“¤ì­‰ë‚ ì­‰í•¨",s:{five:1}}] },
  ];

  const mainContent = document.getElementById("mainContent");
  const pageTitle = document.getElementById("pageTitle");
  const pageSub = document.getElementById("pageSub");
  const stepPill = document.getElementById("stepPill");
  const barFill = document.getElementById("barFill");

  function render() {
    barFill.style.width = '0%';
    state.isProcessing = false; 
    CURRENT_URL = window.location.href;

    if (state.view === 'home') {
      setTitle("ìì—° ì† ì˜¤ê°í…Œë¼í”¼ BOOK", "ê·¸ë¦¼ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—ì„¼ì…œì˜¤ì¼/í‹°í…Œë¼í”¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.", "HOME");
      mainContent.innerHTML = `
        <div class="menu-grid">
          <button class="hero-btn" onclick="setView('essential')">
            <div class="icon-area">${ICONS.oil}</div>
            <div>
              <div class="label">ì—ì„¼ì…œ ì˜¤ì¼</div>
              <div class="desc">1. ì·¨í–¥ ì°¾ê¸°<br>2. ë¸”ëœë”© ì˜¤ì¼ ë ˆì‹œí”¼</div>
            </div>
          </button>
          <button class="hero-btn" onclick="setView('tea')">
            <div class="icon-area">${ICONS.tea}</div>
            <div>
              <div class="label">ë‹¤ë„ (Tea Therapy)</div>
              <div class="desc">ì•½ì„ ì°¨ / í—ˆë¸Œì°¨ / ë…¹ì°¨<br>í‹° ë¸”ëœë”© ë ˆì‹œí”¼</div>
            </div>
          </button>
        </div>
      `;
    } 
    else if (state.view === 'essential') {
      setTitle("ì—ì„¼ì…œ ì˜¤ì¼ í…Œë¼í”¼", "ì›í•˜ëŠ” ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "Oil");
      mainContent.innerHTML = `
        <div class="choices">
          <button class="choice" onclick="startOilQuiz()">1. ì—ì„¼ì…œì˜¤ì¼ ì·¨í–¥ ì°¾ê¸°</button>
          <button class="choice" onclick="setView('oil_recipe_intro')">2. DIY ì•„ë¡œë§ˆ ë¡¤ì˜¨ ë ˆì‹œí”¼</button>
        </div>
        <div class="nav">
          <button class="btn" onclick="setView('home')">â† ë’¤ë¡œê°€ê¸°</button>
        </div>
      `;
    }
    else if (state.view === 'oil_recipe_intro') {
      setTitle("DIY ë¡¤ì˜¨ ë ˆì‹œí”¼", "ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì˜¤ì¼ì„ ì„ íƒí•˜ì‹œê² ì–´ìš”?", "Selection");
      mainContent.innerHTML = `
        <div style="display:grid; gap:12px;">
            <button class="recipe-intro-btn" onclick="setView('oil_recipe_manual')">
                <strong>ğŸ–ï¸ ì§ì ‘ ëª¨ë“  ì˜¤ì¼ ì„ íƒí•˜ê¸°</strong>
                <span>ë‚´ê°€ ì›í•˜ëŠ” í–¥ 3ê°€ì§€ë¥¼<br>ììœ ë¡­ê²Œ ê³¨ë¼ ì¡°í•©í•©ë‹ˆë‹¤.</span>
            </button>
            <button class="recipe-intro-btn" onclick="checkAndGoAutoRecipe()">
                <strong>ğŸ¤– ê²°ê³¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œë°›ê¸°</strong>
                <span>ë‚˜ì˜ ì˜¤ì¼ í…ŒìŠ¤íŠ¸ ê²°ê³¼(Top 5)ë¥¼<br>ë°”íƒ•ìœ¼ë¡œ ì–´ìš¸ë¦¬ëŠ” í–¥ì„ ì¶”ì²œë°›ìŠµë‹ˆë‹¤.</span>
            </button>
        </div>
        <div class="nav"><button class="btn" onclick="setView('essential')">â† ì´ì „ìœ¼ë¡œ</button></div>
      `;
    }
    else if (state.view === 'tea') {
      setTitle("í‹° í…Œë¼í”¼ (Tea Therapy)", "ì˜¤ëŠ˜ì˜ ë‚˜ì—ê²Œ í•„ìš”í•œ ì°¨ë¥¼ ê³¨ë¼ë³´ì„¸ìš”.", "Tea");
      mainContent.innerHTML = `
        <div class="tea-grid">
          <button class="tea-btn" onclick="startQuiz()">
            ${ICONS.yakseon}
            <span>ì•½ì„ ì°¨<br><span class="tiny">(ì¶”ì²œë°›ê¸°)</span></span>
          </button>
          <button class="tea-btn" onclick="alert('í—ˆë¸Œì°¨ ì •ë³´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">
            ${ICONS.herb}
            <span>í—ˆë¸Œì°¨</span>
          </button>
          <button class="tea-btn" onclick="alert('ë…¹ì°¨ ì •ë³´ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">
            ${ICONS.green}
            <span>ë…¹ì°¨</span>
          </button>
        </div>
        <button class="wide-btn" onclick="alert('í‹° ë¸”ëœë”© ë ˆì‹œí”¼ëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.')">
          <span>ğŸµ í‹° ë¸”ëœë”© ë ˆì‹œí”¼ ë³´ê¸°</span>
          <span>OPEN ></span>
        </button>
        <div class="nav">
          <button class="btn" onclick="setView('home')">â† í™ˆìœ¼ë¡œ</button>
        </div>
      `;
    }
    else if (state.view === 'quiz_tea') { renderQuiz(); }
    else if (state.view === 'quiz_oil') { renderOilQuiz(); }
    else if (state.view === 'oil_recipe_manual') { renderRecipeManual(); }
    else if (state.view === 'oil_recipe_auto') { renderRecipeAuto(); }
  }

  window.checkAndGoAutoRecipe = () => {
    if (!state.top5ResultOils || state.top5ResultOils.length === 0) {
        alert("ì´ì „ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.\në¨¼ì € 'ì—ì„¼ì…œì˜¤ì¼ ì·¨í–¥ ì°¾ê¸°'ë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.");
        return;
    }
    state.selectedRecipeOils = []; // ì´ˆê¸°í™”
    setView('oil_recipe_auto');
  };

  function startQuiz() {
    state.view = 'quiz_tea';
    state.quizStep = 0;
    state.quizPicks = Array(TEA_QUESTIONS.length).fill(null);
    state.quizScores = {};
    Object.keys(TEA_TYPES).forEach(k => state.quizScores[k] = 0);
    render();
  }
  window.startQuiz = startQuiz;

  function renderQuiz() {
    const progress = (state.quizStep / TEA_QUESTIONS.length) * 100;
    barFill.style.width = `${progress}%`;
    if (state.quizStep >= TEA_QUESTIONS.length) { renderResult(); return; }
    const q = TEA_QUESTIONS[state.quizStep];
    const picked = state.quizPicks[state.quizStep];
    setTitle("ì•½ì„ ì°¨ ì¶”ì²œ", "ë‚˜ì˜ ìƒíƒœë¥¼ ì²´í¬í•´ë³´ì„¸ìš”.", `${state.quizStep+1} / ${TEA_QUESTIONS.length}`);
    mainContent.innerHTML = `
      <h2 class="q-title">${q.q}</h2>
      <div class="choices">${q.a.map((ans, idx) => `<button class="choice" onclick="pickAnswer(${idx})" aria-pressed="${picked===idx}">${ans.t}</button>`).join("")}</div>
      <div class="nav"><button class="btn" onclick="prevStep()" ${state.quizStep===0 ? 'disabled':''}>ì´ì „</button><button class="btn danger" onclick="setView('tea')">ì·¨ì†Œ</button></div>`;
  }

  window.pickAnswer = (idx) => { state.quizPicks[state.quizStep] = idx; if (state.quizStep < TEA_QUESTIONS.length) { state.quizStep++; render(); } };
  window.prevStep = () => { if (state.quizStep > 0) { state.quizStep--; render(); } };

  function renderResult() {
    const finalScores = {};
    Object.keys(TEA_TYPES).forEach(k => finalScores[k] = 0);
    state.quizPicks.forEach((pidx, qidx) => {
      if (pidx === null) return;
      const scores = TEA_QUESTIONS[qidx].a[pidx].s;
      for (const [k, v] of Object.entries(scores)) finalScores[k] += v;
    });
    const ranking = Object.entries(finalScores).sort((a,b) => b[1]-a[1]);
    const topKey = ranking[0][0];
    const topType = TEA_TYPES[topKey];
    setTitle("ê²°ê³¼ í™•ì¸", "ì˜¤ëŠ˜ ë‹¹ì‹ ì—ê²Œ ê°€ì¥ í•„ìš”í•œ ì°¨ëŠ”?", "ì™„ë£Œ");
    barFill.style.width = '100%';
    mainContent.innerHTML = `
      <section class="result">
        <div class="box" style="text-align:center; padding:30px 20px;">
          <div style="font-size:14px; color:#2f8a58; font-weight:700; margin-bottom:10px;">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ì•½ì„ ì°¨</div>
          <h2 style="font-size:26px; margin:0 0 10px; color:#000;">${topType.name}</h2>
          <div style="color:#333; font-weight:600; font-size:16px; margin-bottom:12px;">${topType.example}</div>
          <p style="color:#555; line-height:1.6;">"${topType.pitch}"</p>
          <div style="margin-top:20px">${topType.tags.map(t => `<span class="tag">#${t}</span>`).join("")}</div>
        </div>
        <div class="box">
          <div class="tiny">ê²°ê³¼ í™œìš©í•˜ê¸°</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn capture" onclick="captureResult('app', '${topType.name}_ê²°ê³¼')">ğŸ“· ì´ë¯¸ì§€ ì €ì¥</button>
            <button class="btn primary" onclick="shareResult('${topKey}', '${topType.name}')">ê²°ê³¼ ê³µìœ </button>
            <button class="btn" onclick="startQuiz()">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸</button>
            <button class="btn" onclick="setView('tea')">ë©”ë‰´ë¡œ</button>
          </div>
        </div>
      </section>
    `;
  }

  // --- OIL QUIZ ---
  window.startOilQuiz = () => {
    state.view = 'quiz_oil';
    state.oilStep = 0;
    state.oilTags = [];
    state.userPreference = null;
    render();
  };

  function renderOilQuiz() {
    const progress = (state.oilStep / OIL_QUESTIONS.length) * 100;
    barFill.style.width = `${progress}%`;
    if (state.oilStep >= OIL_QUESTIONS.length) { renderOilResult(); return; }
    
    const q = OIL_QUESTIONS[state.oilStep];
    const isPref = q.id === "pref";
    
    setTitle(isPref ? "ì·¨í–¥ íƒìƒ‰" : "ë‚´ë©´ íƒìƒ‰", 
             isPref ? "í‰ì†Œ ì„ í˜¸í•˜ëŠ” í–¥ê¸°ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”." : "ë‹¹ì‹ ì˜ ê°ê°ì„ ë”°ë¼ê°€ë³´ì„¸ìš”.", 
             `${state.oilStep+1} / ${OIL_QUESTIONS.length}`);
             
    let optionsHtml = '';
    
    if (isPref) {
      optionsHtml = `<div class="pref-grid">
        ${q.options.map((opt) => `
          <div class="pref-card" onclick="handleOptionClick(this, '${opt.tag}')">
            <img src="${opt.img}" alt="${opt.text}" class="pref-img">
            <div class="pref-name">${opt.text}</div>
            <div class="pref-desc">${opt.desc}</div>
          </div>
        `).join("")}
      </div>`;
    } else {
      optionsHtml = `<div class="choices">
        ${q.options.map((opt) => `<button class="choice" onclick="handleOptionClick(this, '${opt.tag}')">${opt.text}</button>`).join("")}
      </div>`;
    }

    mainContent.innerHTML = `
      <h2 class="q-title">${q.q}</h2>
      ${optionsHtml}
      <div class="nav"><button class="btn" onclick="prevOilStep()" ${state.oilStep===0 ? 'disabled':''}>ì´ì „</button><button class="btn danger" onclick="setView('essential')">ì·¨ì†Œ</button></div>`;
  }

  window.handleOptionClick = (element, tag) => {
    if (state.isProcessing) return;
    state.isProcessing = true;
    element.classList.add('clicked');
    setTimeout(() => {
        pickOilAnswer(tag);
    }, 150); 
  };

  window.pickOilAnswer = (tag) => {
    if (OIL_QUESTIONS[state.oilStep].id === "pref") {
        state.userPreference = tag; 
    } else {
        state.oilTags[state.oilStep] = tag; 
    }
    state.oilStep++; 
    render(); 
  };
  
  window.prevOilStep = () => { if (state.oilStep > 0) { state.oilStep--; render(); } };

  function renderOilResult() {
    let scoredOils = OIL_DATA.map(oil => {
        let score = oil.tags.filter(t => state.oilTags.includes(t)).length;
        return { ...oil, score: score + Math.random() * 0.5 }; 
    });
    
    scoredOils.sort((a, b) => b.score - a.score);
    const top5 = scoredOils.slice(0, 5);
    state.top5ResultOils = top5; // ê²°ê³¼ ì €ì¥
    const bestOil = top5[0];

    const catCounts = {};
    top5.forEach(o => { catCounts[o.category] = (catCounts[o.category] || 0) + 1; });
    const topCat = Object.keys(catCounts).sort((a,b) => catCounts[b] - catCounts[a])[0];
    const personaMsg = CATEGORY_PERSONA[topCat] || "ë‹¤ì±„ë¡œìš´ ë§¤ë ¥ì„ ì§€ë‹Œ ì¡°í™”ë¡œìš´ ì‚¬ëŒ";
    const userPref = state.userPreference || "Floral";
    let analysisTitle = "";
    let analysisDesc = "";
    
    const isMatch = userPref === topCat || (userPref === "Woody" && topCat === "Earthy") || (userPref === "Earthy" && topCat === "Woody");

    if (isMatch) {
        analysisTitle = "ğŸŒ¿ ë‚˜ë¥¼ ì‚¬ë‘í•˜ëŠ” ë§ˆìŒ, ê·¸ í‰ì˜¨í•œ ì¼ì¹˜";
        analysisDesc = `ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ê°€ë§Œíˆ ë“¤ì—¬ë‹¤ë³´ë‹ˆ, ì°¸ í‰ì˜¨í•˜ê³  ë‹¨ë‹¨í•œ ìƒíƒœì´ì‹œêµ°ìš”.<br><br>í‰ì†Œ ì¢‹ì•„í•˜ì‹œë˜ <strong>[${userPref}]</strong> í–¥ê¸°ê°€ ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ëª¸ê³¼ ë§ˆìŒì´ ì›í•˜ëŠ” ì—ë„ˆì§€ì™€ ì •í™•íˆ ë§ë‹¿ì•„ ìˆì–´ìš”.`;
    } else {
        analysisTitle = "ğŸ’Œ ë¯¸ì²˜ ëª°ëë˜ ë‚´ ë§ˆìŒì˜ ì‘ì€ ëª©ì†Œë¦¬";
        analysisDesc = `ì¡°ê¸ˆì€ ë‚¯ì„  ê²°ê³¼ì— ê³ ê°œë¥¼ ê°¸ìš°ëš±í•˜ì…¨ë‚˜ìš”? í‰ì†Œ ì¢‹ì•„í•˜ë˜ í–¥ê¸°ê°€ ë‹¹ì‹ ì˜ 'ë©‹ì§„ ëª¨ìŠµ'ì„ ëŒ€ë³€í–ˆë‹¤ë©´, ì˜¤ëŠ˜ ë°œê²¬ëœ ì´ í–¥ê¸°ëŠ” ë‹¹ì‹ ì˜ ë¬´ì˜ì‹ì´ ì¡°ì‹¬ìŠ¤ë ˆ ë³´ë‚´ì˜¨ <strong>'ì§„ì§œ ìœ„ë¡œ'</strong>ì˜ í¸ì§€ì˜ˆìš”.`;
    }

    let noteAdvice = "";
    if (bestOil.note === 'T') {
        noteAdvice = `<br><br><strong>ğŸ’¡ Top Note ì²˜ë°©:</strong><br>"ì§€ê¸ˆ ë‹¹ì‹ ì˜ ì–´ê¹¨ê°€ ì¡°ê¸ˆ ë¬´ê±°ìš´ ê±´ ì•„ë‹Œê°€ìš”? ê°€ë²¼ìš´ ì „í™˜ì´ í•„ìš”í•œ ì‹œê¸°ì˜ˆìš”."`;
    } else if (bestOil.note === 'M') {
        noteAdvice = `<br><br><strong>ğŸ’¡ Middle Note ì²˜ë°©:</strong><br>"ëˆ„êµ°ê°€ì—ê²Œ ë‚´ì¤€ ë§ˆìŒë§Œí¼, ì •ì‘ ë‹¹ì‹ ì˜ ë§ˆìŒì€ ì¡°ê¸ˆ í—ˆì „í–ˆë‚˜ ë´ìš”."`;
    } else if (bestOil.note === 'B') {
        noteAdvice = `<br><br><strong>ğŸ’¡ Base Note ì²˜ë°©:</strong><br>"ì ì‹œ íœ˜ì²­ì—¬ë„ ê´œì°®ì•„ìš”. ëŒ€ì§€ì²˜ëŸ¼ êµ³ê±´í•œ ë²„íŒ€ëª©ì´ í•„ìš”í•´ìš”."`;
    }

    barFill.style.width = '100%';
    setTitle("ìƒë‹´ ê²°ê³¼", "ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì½ì–´ë³´ì•˜ìŠµë‹ˆë‹¤.", "ì™„ë£Œ");

    mainContent.innerHTML = `
      <section class="result">
        <div class="box" style="padding:24px 20px;">
          <div style="display:flex; justify-content:center; gap:10px; margin-bottom:24px;">
            <div style="background:#f5f5f5; padding:8px 16px; border-radius:20px; font-size:13px; color:#6d4c41;">
              â¤ï¸ ì˜ì‹ì˜ í–¥: <strong>${userPref}</strong>
            </div>
            <div style="background:#e8f5e9; padding:8px 16px; border-radius:20px; font-size:13px; color:#2e7d32; border:1px solid #2e7d32;">
              ğŸ’Š ë¬´ì˜ì‹ì˜ í–¥: <strong>${topCat}</strong>
            </div>
          </div>

          <div class="analysis-box">
             <div class="analysis-title">${analysisTitle}</div>
             <div class="analysis-text">${analysisDesc}${noteAdvice}</div>
          </div>
          
          <div class="persona-card">
            <div class="persona-title">#${topCat} Type ì„±í–¥</div>
            <div class="persona-desc">${personaMsg}</div>
          </div>

          <div style="width:100%; height:1px; background:#d7ccc8; margin:24px 0; opacity:0.5;"></div>

          <div class="empathy-msg">"ì§€ê¸ˆì€, ${bestOil.desc}"</div>
          
          <div id="oil-list">
            ${top5.map((oil, idx) => `
              <div class="oil-card ${idx===0 ? 'best' : ''}">
                <div style="flex:1;">
                  <div style="font-size:${idx===0? '18px':'16px'}; margin-bottom:6px; ${idx===0?'color:#d4a024; font-weight:700;':''}">
                    ${idx+1}. ${oil.name}
                  </div>
                  <div class="scent-desc" style="font-size:13px; color:#5d4037; line-height:1.4;">${oil.scentDesc}</div>
                </div>
              </div>
            `).join("")}
          </div>

          <button class="btn accent" onclick="checkAndGoAutoRecipe()">
            ğŸ§ª ì´ ì²˜ë°©ëŒ€ë¡œ ë¡¤ì˜¨ ë§Œë“¤ê¸°
          </button>

          <div class="closing-q">"ì´ í–¥ê¸°ë¥¼ ë§¡ìœ¼ë©°,<br>ì˜¤ëŠ˜ ê°€ì¥ í•˜ê³  ì‹¶ì€ ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?"</div>
          <div class="signature">ìì—°í™˜ê²½í•´ì„¤ì‚¬ ì •ì£¼í¬ ë“œë¦¼ ğŸŒ¿</div>

        </div>
        
        <div style="display:flex; gap:6px; margin-top:12px;">
          <button class="btn capture" onclick="captureResult('app', '${bestOil.name}_ê²°ê³¼')">ğŸ“· ì €ì¥</button>
          <button class="btn primary" onclick="shareResult('${bestOil.name}')">ê³µìœ </button>
          <button class="btn" onclick="startOilQuiz()">ë‹¤ì‹œí•˜ê¸°</button>
          <button class="btn" onclick="setView('essential')">ë©”ë‰´</button>
        </div>
      </section>
    `;
  }

  // --- MANUAL RECIPE ---
  function renderRecipeManual() {
    setTitle("ë‚˜ë§Œì˜ ë ˆì‹œí”¼ (ì§ì ‘ ì„ íƒ)", "ì›í•˜ëŠ” ì˜¤ì¼ì„ ìµœëŒ€ 3ê°œ ì„ íƒí•˜ì„¸ìš”.", "Manual");
    const isBtnDisabled = state.selectedRecipeOils.length === 0;
    
    mainContent.innerHTML = `
      <div class="selection-grid">
        ${OIL_DATA.map(oil => {
            const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
            return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleRecipeOil('${oil.name}')">${oil.name}</div>`;
        }).join('')}
      </div>
      <button id="recipeBtn" class="wide-btn" style="text-align:center; justify-content:center; background:var(--accent); color:#fff; font-weight:bold;" 
        ${isBtnDisabled ? 'disabled' : ''} onclick="calcRecipe('manual')">ğŸŒ¿ ë ˆì‹œí”¼ ë„ì¶œí•˜ê¸°</button>
      <div id="recipeResult" style="display:none; margin-top:20px;"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „ìœ¼ë¡œ</button></div>`;
  }

  // --- AUTO RECIPE (NEW) ---
  function renderRecipeAuto() {
    setTitle("ë§ì¶¤ ë ˆì‹œí”¼ (ìë™ ì¶”ì²œ)", "ê²°ê³¼ ëª©ë¡ì—ì„œ 1~2ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", "Auto");
    
    // ì„ íƒëœ ì˜¤ì¼ ê°œìˆ˜ì— ë”°ë¥¸ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    const selCount = state.selectedRecipeOils.length;
    let btnText = "ì˜¤ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”";
    let isBtnDisabled = true;
    
    if (selCount === 1) {
        btnText = "ë‚˜ë¨¸ì§€ 2ê°œ ìë™ ì¶”ì²œë°›ê¸°";
        isBtnDisabled = false;
    } else if (selCount === 2) {
        btnText = "ë‚˜ë¨¸ì§€ 1ê°œ ìë™ ì¶”ì²œë°›ê¸°";
        isBtnDisabled = false;
    } else if (selCount >= 3) {
        btnText = "2ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤";
        isBtnDisabled = true;
    }

    mainContent.innerHTML = `
      <div style="background:#fff3e0; padding:12px; border-radius:12px; font-size:14px; color:#ef6c00; margin-bottom:16px; text-align:center; word-break:keep-all;">
        ğŸ’¡ í…ŒìŠ¤íŠ¸ ê²°ê³¼(Top 5) ì¤‘ ê°€ì¥ ë§ˆìŒì— ë“œëŠ” ì˜¤ì¼ì„ 1~2ê°œë§Œ ê³¨ë¼ì£¼ì„¸ìš”. ë‚˜ë¨¸ì§€ëŠ” AIê°€ ì¡°í™”ë¡­ê²Œ ì±„ì›Œë“œë¦½ë‹ˆë‹¤.
      </div>
      <div class="selection-grid">
        ${state.top5ResultOils.map(oil => {
            const isSelected = state.selectedRecipeOils.some(o => o.name === oil.name);
            return `<div class="oil-select-item ${isSelected ? 'selected' : ''}" onclick="toggleAutoRecipeOil('${oil.name}')">
                <div style="font-size:12px; margin-bottom:4px; opacity:0.8;">${oil.category}</div>
                ${oil.name}
            </div>`;
        }).join('')}
      </div>
      
      <button id="autoRecipeBtn" class="wide-btn" style="text-align:center; justify-content:center; background:var(--accent); color:#fff; font-weight:bold;" 
        ${isBtnDisabled ? 'disabled' : ''} onclick="runAutoRecommend()">âœ¨ ${btnText}</button>
      
      <div id="recipeResult" style="display:none; margin-top:20px;"></div>
      <div class="nav"><button class="btn" onclick="setView('oil_recipe_intro')">ì´ì „ìœ¼ë¡œ</button></div>`;
  }

  // --- Handlers ---
  window.toggleRecipeOil = (name) => {
    const oil = OIL_DATA.find(o => o.name === name);
    const idx = state.selectedRecipeOils.findIndex(o => o.name === name);
    if (idx > -1) { state.selectedRecipeOils.splice(idx, 1); }
    else { 
        if (state.selectedRecipeOils.length >= 3) { alert("ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒí•˜ëŠ” ê²ƒì´ í–¥ì´ ê°€ì¥ ì¡°í™”ë¡­ìŠµë‹ˆë‹¤."); return; } 
        state.selectedRecipeOils.push(oil); 
    }
    renderRecipeManual(); 
  };

  window.toggleAutoRecipeOil = (name) => {
    const oil = OIL_DATA.find(o => o.name === name);
    const idx = state.selectedRecipeOils.findIndex(o => o.name === name);
    if (idx > -1) { state.selectedRecipeOils.splice(idx, 1); }
    else { 
        if (state.selectedRecipeOils.length >= 2) { alert("ìë™ ì¶”ì²œì„ ìœ„í•´ ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ì„ íƒí•´ì£¼ì„¸ìš”."); return; } 
        state.selectedRecipeOils.push(oil); 
    }
    renderRecipeAuto(); 
  };

  // AI ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜
  window.runAutoRecommend = () => {
    const currentPicks = [...state.selectedRecipeOils];
    const targetCount = 3;
    const needed = targetCount - currentPicks.length;
    
    // í˜„ì¬ ì„ íƒëœ ë…¸íŠ¸ë“¤ íŒŒì•… (Top, Middle, Base)
    const currentNotes = currentPicks.map(o => o.note);
    const currentNames = currentPicks.map(o => o.name);
    
    // í›„ë³´êµ°: ì´ë¯¸ ì„ íƒë˜ì§€ ì•Šì€ ëª¨ë“  ì˜¤ì¼
    let candidates = OIL_DATA.filter(o => !currentNames.includes(o.name));
    
    // 1. ë…¸íŠ¸ ë°¸ëŸ°ì‹± ì ìˆ˜ ë¶€ì—¬
    // ì—†ëŠ” ë…¸íŠ¸ë¥¼ ì±„ì›Œì£¼ëŠ” ì˜¤ì¼ì— ê°€ì‚°ì 
    candidates.forEach(c => {
        c.tempScore = 0;
        if (!currentNotes.includes(c.note)) c.tempScore += 5; // ì—†ëŠ” ë…¸íŠ¸ë©´ +5ì 
        
        // ì¹´í…Œê³ ë¦¬ ë‹¤ì–‘ì„± (ê°™ì€ ì¹´í…Œê³ ë¦¬ í”¼í•˜ê¸°)
        const isSameCat = currentPicks.some(p => p.category === c.category);
        if (!isSameCat) c.tempScore += 2;
        
        c.tempScore += Math.random(); // ëœë¤ ìš”ì†Œ
    });
    
    // ì ìˆ˜ ë†’ì€ ìˆœ ì •ë ¬
    candidates.sort((a,b) => b.tempScore - a.tempScore);
    
    // í•„ìš”í•œ ë§Œí¼ ì¶”ê°€
    const recommendations = candidates.slice(0, needed);
    
    // State ì—…ë°ì´íŠ¸ (AI í”½ í‘œì‹œë¥¼ ìœ„í•´)
    const finalOils = [...currentPicks, ...recommendations];
    
    // ê²°ê³¼ í‘œì‹œ
    displayRecipeResult(finalOils, recommendations.map(r => r.name));
  };

  window.calcRecipe = () => {
     displayRecipeResult(state.selectedRecipeOils, []);
  };

  function displayRecipeResult(oils, aiPickNames) {
    const resultDiv = document.getElementById('recipeResult');
    resultDiv.style.display = 'block';
    
    // ì˜¤ì¼ ìˆœì„œ: ë² ì´ìŠ¤ -> ë¯¸ë“¤ -> íƒ‘ (ë¬´ê²Œê° ìˆœìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° or ê·¸ëƒ¥ ìˆœì„œëŒ€ë¡œ)
    // ì—¬ê¸°ì„  ê·¸ëƒ¥ ìˆœì„œëŒ€ë¡œ í•˜ë˜ ë¹„ìœ¨ ê³„ì‚°
    let distribution = oils.length === 1 ? [20] : (oils.length === 2 ? [12, 8] : [10, 6, 4]);
    
    let rows = oils.map((oil, idx) => {
        const isAi = aiPickNames.includes(oil.name);
        return `<div class="drop-row">
            <span>
                ${isAi ? '<span style="font-size:11px; background:#d4a024; color:#fff; padding:2px 5px; border-radius:4px; margin-right:4px;">AI</span>' : ''}
                ğŸ’§ ${oil.name} <span style="font-size:12px; color:#888;">(${oil.note} Note)</span>
            </span>
            <strong>${distribution[idx]} ë°©ìš¸</strong>
        </div>`;
    }).join('');

    resultDiv.innerHTML = `
      <div class="recipe-box">
        <h3 style="margin:0 0 15px; text-align:center; color:#2f8a58;">ğŸ“‹ ë‚˜ë§Œì˜ ë¸”ë Œë”© (10ml ê¸°ì¤€)</h3>
        ${rows}
        <div style="margin-top:15px; text-align:center; font-weight:bold; color:#d4a024; font-size:14px;">+ ìºë¦¬ì–´ ì˜¤ì¼(í˜¸í˜¸ë°” ë“±) 9ml ì±„ìš°ê¸°</div>
      </div>
      <div class="guide-box"><strong>ğŸ’¡ ë§Œë“¤ê¸° ê°€ì´ë“œ:</strong><br>1. ì†Œë…ëœ 10ml ë¡¤ì˜¨ ë³‘ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.<br>2. ìœ„ ë ˆì‹œí”¼ëŒ€ë¡œ <strong>ì—ì„¼ì…œ ì˜¤ì¼ì„ ë¨¼ì €</strong> ë„£ìŠµë‹ˆë‹¤.<br>3. ë‚˜ë¨¸ì§€ ê³µê°„ì„ ìºë¦¬ì–´ ì˜¤ì¼ë¡œ ì±„ì›ë‹ˆë‹¤.<br>4. í”ë“¤ì–´ì„œ í•˜ë£¨ ë’¤ ì‚¬ìš©í•˜ì„¸ìš”.</div>
      <div style="margin-top:15px; display:flex; gap:10px;">
        <button class="btn capture" style="flex:1" onclick="captureResult('app', 'ë‚˜ë§Œì˜_ë ˆì‹œí”¼')">ğŸ“· ë ˆì‹œí”¼ ì €ì¥</button>
        <button class="btn" style="flex:1" onclick="setView('essential')">ì²˜ìŒìœ¼ë¡œ</button>
      </div>`;
      
    setTimeout(() => { resultDiv.scrollIntoView({ behavior: 'smooth' }); }, 100);
  }

  window.setView = (viewName) => { 
      state.view = viewName; 
      if (viewName === 'oil_recipe_manual') state.selectedRecipeOils = []; 
      // introë‚˜ autoì—ì„œ ë‚˜ì˜¬ë•ŒëŠ” ì´ˆê¸°í™”í•˜ì§€ ì•ŠìŒ (auto ë‚´ë¶€ì—ì„œ ë¡œì§ ì²˜ë¦¬)
      render(); 
  };
  
  function setTitle(title, sub, pill) { pageTitle.textContent = title; pageSub.textContent = sub; stepPill.textContent = pill; }
  
  window.captureResult = (elementId, fileName) => {
    const element = document.getElementById(elementId);
    alert("ì´ë¯¸ì§€ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...");
    html2canvas(element, { backgroundColor: "#ffffff", scale: 2 }).then(canvas => {
        const link = document.createElement('a'); link.download = fileName + '.png'; link.href = canvas.toDataURL(); link.click();
    }).catch(err => { alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); });
  };
  
  window.openShareModal = async () => {
    const url = window.location.href; 
    document.getElementById('shareUrlInput').value = url;
    document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=${encodeURIComponent(url)}`;
    if (navigator.share) { try { await navigator.share({ title: 'ìì—° ì† ì˜¤ê°í…Œë¼í”¼', text: 'ë‚˜ì—ê²Œ ë§ëŠ” ìì—°ì˜ í–¥ê¸°ì™€ ì°¨ë¥¼ ì°¾ì•„ë³´ì„¸ìš”.', url: url }); return; } catch (e) {} } 
    document.getElementById('shareModal').classList.remove('hidden'); 
  };
  window.closeShareModal = () => document.getElementById('shareModal').classList.add('hidden');
  window.copyShareUrl = () => { const input = document.getElementById('shareUrlInput'); input.select(); try { navigator.clipboard.writeText(input.value).then(() => alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.")); } catch(err) { document.execCommand('copy'); alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."); } };
  window.shareResult = async (key, name) => { const url = window.location.href; const text = `[ìì—° ì† ì˜¤ê°í…Œë¼í”¼] ê²°ê³¼ ê³µìœ : "${name}"`; try { if (navigator.share) { await navigator.share({ title: "ì˜¤ê°í…Œë¼í”¼ ê²°ê³¼", text: text, url: url }); } else { await navigator.clipboard.writeText(url); alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤."); } } catch(e) {} };

  render();
})();
</script>
</body>
</html>